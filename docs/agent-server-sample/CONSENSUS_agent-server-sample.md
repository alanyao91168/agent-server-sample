# CONSENSUS_agent-server-sample

## 1. 明确的需求描述和验收标准

### 1.1. 需求描述
构建一个基于 Trae IDE 的 AI Agent Server 框架，支持 A2A (Agent-to-Agent) 协议。
- **服务端**: 基于 Golang (网关/调度) 和 Python (AI 业务逻辑) 的混合架构。
- **客户端**: 支持多种 Agent 客户端接入。
- **通信**: 采用标准化的 A2A 消息协议。
- **管理**: 集成 git-agent 进行版本和工作区管理。

### 1.2. 验收标准
- [ ] A2A 协议基础消息收发功能正常。
- [ ] Golang 网关能正确路由请求至 Python AI 服务。
- [ ] Python AI 服务能处理 LLM 推理请求并返回结果。
- [ ] git-agent 能自动化创建分支和独立的物理开发目录。
- [ ] 完整的技术文档和 API 参考手册。

## 2. 技术实现方案和技术约束

### 2.1. A2A 协议传输层方案对比

| 协议 | 特点 | 优势 | 劣势 | 推荐场景 |
| :--- | :--- | :--- | :--- | :--- |
| **HTTP (REST/JSON)** | 短连接，请求-响应模型 | 简单、通用、防火墙友好 | 延迟相对高、不支持服务端推送 | 简单的单次请求响应、外部 API 接入 |
| **gRPC (HTTP/2)** | 长连接，双向流，二进制序列化 | 高性能、强类型、支持流式通信 | 调试复杂、浏览器支持有限 | 内部微服务通信、高性能 Agent 交互 |
| **WebSocket** | 全双工长连接 | 实时性强、低延迟推送 | 需要处理连接状态和重连逻辑 | 实时状态更新、持续对话流 |
| **MQTT** | 发布/订阅模型 | 极轻量、适合弱网和大量连接 | 语义相对简单，不适合复杂 RPC | 大规模智能体集群、状态通知 |

### 2.2. 技术选型
- **外部通信 (Client 接入 Server)**: 
  - **HTTP (REST)**: 用于常规的单次请求响应。
  - **WebSocket**: 用于流式输出、长对话以及实时状态更新。
- **内部通信**: 采用 **gRPC** 以确保高性能和流式数据交换。
- **AI 推理后端**: MVP 阶段优先集成 **Ollama** (本地) 和 **OpenAI API** (云端)。

### 2.3. 集成方案
- **网关层 (Golang)**: 暴露 HTTP/gRPC 接口，解析 A2A 协议，进行身份验证和限流。
- **业务层 (Python)**: 实现具体的 AI 算法和模型集成，通过 gRPC 与网关通信。
- **管理层 (git-agent)**: 负责自动化工作流，物理隔离不同功能的开发环境。

## 3. 任务边界限制和验收标准

### 3.1. 边界限制
- **MVP 阶段**: 专注于单机部署和核心通信链路。
- **AI 模型**: 初始阶段集成主流开源模型接口（如 OpenAI API 或 Ollama）。
- **存储**: 优先实现 Redis 缓存和 PostgreSQL 基础存储。

### 3.2. 验收标准 (细化)
- **协议验证**: 通过自动化脚本验证消息的封装和解析。
- **集成测试**: 模拟 Client 发送请求，通过网关处理后获得 AI 服务响应。
- **性能指标**: 核心消息转发延迟 < 100ms (不含 AI 推理时间)。

## 4. 确认所有不确定性已解决

### 4.1. 已解决
- 技术栈架构：Golang + Python + Quasar。
- 开发管理：git-agent 物理目录模式。
- 文档规范：中文文档和代码注释。

### 4.2. 待确认 (即刻决策点)
- 是否同意 **gRPC + HTTP/WebSocket** 的混合传输层方案？
- MVP 阶段是否优先集成 **Ollama** 或 **OpenAI API** 作为基础 AI 能力？

请确认以上方案，以便我进入 **阶段2: Architect (架构阶段)** 进行详细设计。